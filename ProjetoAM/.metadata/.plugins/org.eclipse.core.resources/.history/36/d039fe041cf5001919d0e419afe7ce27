package br.com.algoris.bo;

import java.util.ArrayList;
import java.util.List;

import br.com.algoris.beans.Curso;
import br.com.algoris.beans.Login;
import br.com.algoris.dao.LoginDAO;


public class LoginBO {

	private Login l;
	private LoginDAO dao;
	private String resposta;
	private List<Login> lista;
	
	public LoginBO() throws Exception{
		l = new Login();
		dao = new LoginDAO();
		lista = new ArrayList<Login>();
	}
	
	public String verificaCampos(Login log)throws Exception{
		resposta = "OK";
		
		if (log.getRm() == null || log.getRm() == "" || log.getRm().length() > 10)
			return "Rm Inválido!";
		if (log.getSenha() == null || log.getSenha() == "" || log.getSenha().length()>20)
			return "Senha Inválido!";
		if (log.getTipo() == null || log.getTipo() == "" || log.getTipo().length()>5)
			return "Tipo login Inválido!";
		
		log.setRm(log.getRm().toUpperCase());
		log.setTipo(log.getTipo().toUpperCase());
		
		return resposta;
	}
	
	public String verificaExiste(Login l)throws Exception{
		resposta = "VERIFICADO";
		
		l = dao.consultaPorCodigo(l.getCodigo());
		if (l.getCodigo() > 0) {
			dao.fechar();
			return "Login Já Existe!";
		}
		
		return resposta;
	}
	
	public String cadastrarLogin(Login l)throws Exception{
		
		 resposta = verificaCampos(l);
		
		if(resposta.equals("OK")) {
			resposta = verificaExiste(l);
		}
		
		if(resposta.equals("VERIFICADO")) {
			if(l.getTipo().equals("ADMIN")) {
				resposta = dao.gravarAdim(l);
				dao.fechar();
			}
			else if(l.getTipo().equals("PROF")) {
				resposta = dao.gravarProfessor(l);
				dao.fechar();
			}
			else {
				resposta = dao.gravarAluno(l);
				dao.fechar();
			}
				
		}
		
		return resposta;

}

	public String atualizarSenha(Login l)throws Exception{
		resposta = verificaCampos(l);
		
		l = dao.consultaPorCodigo(l.getCodigo());
		
		if(l.getCodigo() > 0) {
				resposta = dao.atualizaSenha(l);
				dao.fechar();
		}else {
			dao.fechar();
			return "Login Inválido!";
		}
		
		dao.fechar();
		return resposta;
	}

	public String deletarLogin(Login l)throws Exception{
		l = dao.consultaPorCodigo(l.getCodigo());
		
		if(l.getCodigo() > 0 ) {
			resposta = dao.gravarAdim(l);
		}else {
			resposta = "Erro ao Deletar Login!";
		}
		
		dao.fechar();
		return resposta;
	}
}
